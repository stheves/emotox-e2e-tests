name: Cypress E2E Tests
on:
    push:
        branches:
            - 'main'
    pull_request:
jobs:
    basic-ubuntu-20-v10:
        runs-on: ubuntu-20.04
        name: E2E on Chrome
        steps:
            - name: Checkout
              uses: actions/checkout@v2

            - name: Cypress tests
              uses: cypress-io/github-action@v4.x.x
              with:
                  browser: chrome
                  install-command: yarn install --immutable --immutable-cache
                  command: yarn cy:e2e

            - name: upload failure screenshots
              uses: actions/upload-artifact@v2
              if: failure()
              with:
                  name: cypress-screenshots
                  path: cypress/screenshots

            - name: upload failure videos
              uses: actions/upload-artifact@v2
              if: failure()
              with:
                  name: cypress-videos
                  path: cypress/videos

    # basic-on-windows-v10:
    #   runs-on: windows-latest
    #   steps:
    #     - name: Checkout
    #       uses: actions/checkout@v2

    #     - name: Cypress tests
    #       uses: ./
    #       with:
    #         working-directory: examples/v10/basic
    #         build: npx cypress info

    # basic-on-mac-v10:
    #   runs-on: macos-latest
    #   steps:
    #     - name: Checkout
    #       uses: actions/checkout@v2

    #     - name: Cypress tests
    #       uses: ./
    #       with:
    #         working-directory: examples/v10/basic
    #         build: npx cypress info

    # skips the binary installation
    # shows that the job should not fail
    # https://github.com/cypress-io/github-action/issues/327
    # basic-without-binary-install-v10:
    #     runs-on: ubuntu-20.04
    #     steps:
    #         - name: Checkout
    #           uses: actions/checkout@v2

    #         - name: Cypress tests
    #           uses: cypress-io/github-action@v2
    #           with:
    #               working-directory: ./
    #               # since we do not install Cypress
    #               # we should not attempt to run tests
    #               runTests: false
    #           env:
    #               # skip the binary install
    #               CYPRESS_INSTALL_BINARY: 0
